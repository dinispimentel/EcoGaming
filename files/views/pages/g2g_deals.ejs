<!DOCTYPE html>

<html>
    <head>
        
        <title>EcoDashboard - G2G Deals</title>
        <link rel="stylesheet" type="text/css" href="css/default.css">
        <link rel="stylesheet" type="text/css" href="css/deals.css">
        <link rel="stylesheet" type="text/css" href="css/g2g_deals.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/utils/notification.css">
        
    </head>

    <body>
        
        <%- include('../partials/header.ejs', {avatar: avatar}) %>

        <!--
        <h1>USER ID: </h1> <h2><%= id %></h2>
        <h1>Username: </h1> <h2><%= username%></h2>
        -->
        <!--<h1>Avatar: </h1> <img src="<%= avatar %> "> -->
        <div class="wrapper">
            <div id="left-side">
                
                    <table id="table-deals" <% if (!(offerbook !== undefined && offerbook !== null && offerbook.offers !== undefined && offerbook.offers !== null) ) { %> hidden <% } %> >
                        <tr class="first-row">
                            <th class="table-header first-header title-entry">Game Title</th>
                            <th class="table-header g2g-price-entry">G2G Price</th>
                            <th class="table-header steam-price-entry">Steam Price</th>
                            <th class="table-header gain-diff-entry">Diff (Val.)</th>
                            <th class="table-header gain-percentage-entry">Diff (%)</th>
                            <th class="table-header offer-count-entry">Offer Count</th> 
                            <th class="table-header black-list-entry">Add to Black List</th> 
                            <th class="table-header last-header transpose-entry">Select</th>  <!--TODO:// Checkbox para btn de "Levar para assign deals" ...  (plano avançado)-->
                        
                        </tr>
                        
                        <% if (offerbook !== undefined && offerbook !== null && offerbook.offers !== undefined && offerbook.offers !== null) { %>
                            <% for( let o = 1; o < Object.keys(offerbook.offers).length; o++ ) { %>
                                <%  let game_title = Object.keys(offerbook.offers)[o];
                                    let offer = offerbook.offers[game_title];
                                    let g2g_price = Number(offer.g2gprice.cValue || offer.g2gprice.value);
                                    let steam_prices = offer.steamprices;
                                    let steam_prices_display = "";
                                    let steam_prices_diffs_ratio = "";
                                    let steam_prices_diffs = "";
                                    let currency = String((offer.g2gprice.cCurrency || offer.g2gprice.currency));
                                    currency = currency === "USD" ? "$" : (currency === "EUR" ? "€" : currency)
                                    for (const steam_price of steam_prices) {
                                        steam_prices_display = steam_prices_display + String(steam_price.cValue.toFixed(2)) + currency + "(" +String(steam_price.currency) + ") | "
                                        steam_prices_diffs = steam_prices_diffs + String((g2g_price - steam_price.cValue).toFixed(2)) + currency + " | "
                                        steam_prices_diffs_ratio = steam_prices_diffs_ratio + String((((g2g_price - steam_price.cValue)/steam_price.cValue)*100).toFixed(2) ) + "% | "
                                    }
                                    steam_prices_display = steam_prices_display.slice(0, steam_prices_display.length-3);
                                    steam_prices_diffs = steam_prices_diffs.slice(0, steam_prices_diffs.length-3);
                                    steam_prices_diffs_ratio = steam_prices_diffs_ratio.slice(0, steam_prices_diffs_ratio.length-3);

                                %> 
                                <tr>
                                    <td class="table-entry first-entry left-align-entry title-entry" id="item-<%=offer.path%>_<%=offer.appID%>">
                                        <div class="force-single-row"><%=game_title%> <a href="https://store.steampowered.com/app/<%=offer.appID%>" target="_blank" class="anchor-entry"><i class="fa-solid fa-circle-up icon-link"></i></a><a href="https://www.g2g.com/categories/<%=offer.path%>" target="_blank" class="anchor-entry"><i class="fa-solid fa-circle-down icon-link"></i></a></div>
                                    </td>
                                    <td class="table-entry g2g-price-entry"><%=String(g2g_price.toFixed(2)) + currency%></td>
                                    <td class="table-entry steam-price-entry" ><%=steam_prices_display%></td>
                                    <td class="table-entry gain-diff-entry"><%=steam_prices_diffs%></td>
                                    <td class="table-entry gain-percentage-entry"><%=steam_prices_diffs_ratio%></td>  <!--TODO:// Fazer sistema de comprar pela tabela mesmo, com API keys etc...  (plano avançado)-->
                                    <td class="table-entry offer-count-entry"><%=String(offer.count)%></td>
                                    <td class="table-entry black-list-entry center-align-entry"><a id="blacklist-<%=game_title%>" class="anchor-entry black-list-link"><i class="fa-solid fa-circle-minus icon-link"></i></a></td>
                                    <td class="table-entry last-entry transpose-entry"><input id="transpose-<%=game_title%>"type="checkbox"></td>  <!--TODO:// Checkbox para btn de "Levar para assign deals" ...  (plano avançado)-->
                                </tr>
                            <% } %>
                        <% } else { %>
                            <div id="no-data">
                                <h1>[No Data Available]</h1>
                            </div>
                        <% } %>
                        
                    </table>
                
            </div>
            <div id="right-side">
                <div id="top-right-side">
                    <div class="button-container">
                        <button class="remote-btn input btn btn-outline-secondary" id="remote-brand-scan">Scan New Games</button>
                        <button class="remote-btn input btn btn-outline-secondary" id="remote-branding">Find Game Brands</button>
                        <button class="remote-btn input btn btn-outline-primary" id="remote-pricing">Price G2G Games</button>
                        <button class="remote-btn input btn btn-outline-secondary" id="remote-steam-appid">Steam App Link</button>
                        <button class="remote-btn input btn btn-outline-primary" id="remote-steam-price">Steam Price</button>
                        <button class="remote-btn input btn btn-outline-success" id="remote-retrieve-deals">Retrieve Best Deals</button>
                        <button class="remote-btn input btn btn-outline-dark" id="remote-move-g2g">Move to Assign Deals Table</button>

                    </div>
                </div>
                <div id="bottom-right-side">
                    <div class="wrapper-v">
                        <div class="progress">
                            <!-- <label for="remote-progress" id="lblprogress">Progress:</label> -->
                            <!-- <progress id="remote-progress" value="0" max="100"></progress> -->
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%" id="progress-bar-remote"></div>
                        </div>
                        <canvas id="proxy-health">

                        </canvas>
                    </div>
                    
                </div>
                
            </div>
        </div>

        <!-- SCRIPTS -->
        <script src="js/jquery-3.6.1.min.js" defer></script>
        <link rel="stylesheet" type="text/css" href="css/utils/form_popup.css">
        <script type="module" src="js/g2g_deals.js" defer></script>
        <!-- <script type="module" src="js/dmarket_deals.js" defer></script> -->
        
    </body>

    
</html>